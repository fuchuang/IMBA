<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.IMBA.dao.stu_courseMapper" >
  <resultMap id="BaseResultMap" type="com.IMBA.entity.stu_courseKey" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <id column="student_id" property="studentId" jdbcType="INTEGER" />
    <id column="course_id" property="courseId" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="CourseResultMap" type="com.IMBA.entity.course" >
    <id column="cou.id" property="id" jdbcType="INTEGER" />
    <result column="cou.course_name" property="courseName" jdbcType="VARCHAR" />
    <result column="cou.classroom" property="classroom" jdbcType="VARCHAR" />
    <result column="cou.course_credit" property="courseCredit" jdbcType="REAL" />
    <result column="cou.course_hour" property="courseHour" jdbcType="INTEGER" />
    <result column="cou.course_quota" property="courseQuota" jdbcType="INTEGER" />
    <result column="cou.day_of_week" property="dayOfWeek" jdbcType="TINYINT" />
    <result column="cou.week_of_semester" property="weekOfSemester" jdbcType="TINYINT" />
    <result column="cou.lesson_of_day" property="lessonOfDay" jdbcType="TINYINT" />
    <result column="cou.course_year" property="courseYear" jdbcType="VARCHAR" />
    <result column="cou.course_type" property="courseType" jdbcType="CHAR" />
    <result column="cou.course_time" property="courseTime" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Course_Result_List" >
   cou.id,cou.course_name, cou.classroom, cou.course_credit, cou.course_hour, cou.course_quota, cou.day_of_week,
    cou.week_of_semester, cou.lesson_of_day, cou.course_year, cou.course_type, cou.course_time
  </sql>
  <delete id="deleteByPrimaryKey" parameterType="com.IMBA.entity.stu_courseKey" >
    delete from stu_course
    where id = #{id,jdbcType=INTEGER}
      and student_id = #{studentId,jdbcType=INTEGER}
      and course_id = #{courseId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.IMBA.entity.stu_courseKey" >
    insert into stu_course (id, student_id, course_id
      )
    values (#{id,jdbcType=INTEGER}, #{studentId,jdbcType=INTEGER}, #{courseId,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.IMBA.entity.stu_courseKey" >
    insert into stu_course
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="studentId != null" >
        student_id,
      </if>
      <if test="courseId != null" >
        course_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="studentId != null" >
        #{studentId,jdbcType=INTEGER},
      </if>
      <if test="courseId != null" >
        #{courseId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="findCoursesOfWeek" resultMap="CourseResultMap"  >
    select
    <include refid="Course_Result_List" />
    from stu_course as sc
    inner join course as cou on cou.id=sc.course_id
                                and cou.course_year=#{year,jdbcType=VARCHAR}
                                and cou.week_of_semester=#{week,jdbcType=TINYINT}
                                and sc.student_id in (
                                  select student_id
                                  from stu_course
                                  where  student_id = #{stuId,jdbcType=INTEGER} )
  </select>

</mapper>